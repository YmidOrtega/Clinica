spring.application.name=api-gateway

# AUTH SERVICE
spring.cloud.gateway.server.webflux.routes[0].id=auth-service
spring.cloud.gateway.server.webflux.routes[0].uri=lb://auth-service
spring.cloud.gateway.server.webflux.routes[0].predicates[0]=Path=/api/v1/auth/**
spring.cloud.gateway.server.webflux.routes[0].filters[0]=AuthenticationFilter

# PATIENT SERVICE
spring.cloud.gateway.server.webflux.routes[1].id=patient-service
spring.cloud.gateway.server.webflux.routes[1].uri=lb://patient-service
spring.cloud.gateway.server.webflux.routes[1].predicates[0]=Path=/api/v1/patients/**
spring.cloud.gateway.server.webflux.routes[1].filters[0]=AuthenticationFilter

# BILLING SERVICE
spring.cloud.gateway.server.webflux.routes[2].id=billing-service
spring.cloud.gateway.server.webflux.routes[2].uri=lb://billing-service
spring.cloud.gateway.server.webflux.routes[2].predicates[0]=Path=/api/v1/billing/**
spring.cloud.gateway.server.webflux.routes[2].filters[0]=AuthenticationFilter

# ADMISSIONS SERVICE
spring.cloud.gateway.server.webflux.routes[3].id=admissions-service
spring.cloud.gateway.server.webflux.routes[3].uri=lb://admissions-service
spring.cloud.gateway.server.webflux.routes[3].predicates[0]=Path=/api/v1/attentions/**
spring.cloud.gateway.server.webflux.routes[3].filters[0]=AuthenticationFilter

# AI ASSISTANT SERVICE
spring.cloud.gateway.server.webflux.routes[4].id=ai-assistant-service
spring.cloud.gateway.server.webflux.routes[4].uri=lb://ai-assistant-service
spring.cloud.gateway.server.webflux.routes[4].predicates[0]=Path=/api/v1/ai-assistant/**
spring.cloud.gateway.server.webflux.routes[4].filters[0]=AuthenticationFilter

# SUPPLIERS SERVICE
spring.cloud.gateway.server.webflux.routes[5].id=suppliers-service
spring.cloud.gateway.server.webflux.routes[5].uri=lb://suppliers-service
spring.cloud.gateway.server.webflux.routes[5].predicates[0]=Path=/api/v1/suppliers/**
spring.cloud.gateway.server.webflux.routes[5].filters[0]=AuthenticationFilter

# CLIENTS SERVICE
spring.cloud.gateway.server.webflux.routes[6].id=clients-service
spring.cloud.gateway.server.webflux.routes[6].uri=lb://clients-service
spring.cloud.gateway.server.webflux.routes[6].predicates[0]=Path=/api/v1/billing-service/health-providers/**
spring.cloud.gateway.server.webflux.routes[6].filters[0]=AuthenticationFilter

# DEFAULT FILTERS (CORS)
spring.cloud.gateway.default-filters[0]=DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
spring.cloud.gateway.default-filters[1]=AddResponseHeader=Access-Control-Allow-Origin,'*'
spring.cloud.gateway.default-filters[2]=AddResponseHeader=Access-Control-Allow-Methods,GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.default-filters[3]=AddResponseHeader=Access-Control-Allow-Headers,'*'

# REDIS CONFIGURATION
spring.data.redis.host=redis-cache
spring.data.redis.port=6379
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD}

#ACTUATOR ROUTES
#AUTH SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[7].id=auth-service-actuator
spring.cloud.gateway.server.webflux.routes[7].uri=lb://auth-service/actuator/auth/**
spring.cloud.gateway.server.webflux.routes[7].predicates[0]=Path=/actuator/auth/**

# PATIENT SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[8].id=patient-service-actuator
spring.cloud.gateway.server.webflux.routes[8].uri=lb://patient-service/actuator/patient/**
spring.cloud.gateway.server.webflux.routes[8].predicates[0]=Path=/actuator/patient/**

# BILLING SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[9].id=billing-service-actuator
spring.cloud.gateway.server.webflux.routes[9].uri=lb://billing-service/actuator/billing/**
spring.cloud.gateway.server.webflux.routes[9].predicates[0]=Path=/actuator/billing/**

# ADMISSIONS SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[10].id=admissions-service-actuator
spring.cloud.gateway.server.webflux.routes[10].uri=lb://admissions-service/actuator/admissions/**
spring.cloud.gateway.server.webflux.routes[10].predicates[0]=Path=/actuator/admissions/**

# AI ASSISTANT SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[11].id=ai-assistant-service-actuator
spring.cloud.gateway.server.webflux.routes[11].uri=lb://ai-assistant-service/actuator/ai-assistant/**
spring.cloud.gateway.server.webflux.routes[11].predicates[0]=Path=/actuator/ai-assistant/**

# SUPPLIERS SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[12].id=suppliers-service-actuator
spring.cloud.gateway.server.webflux.routes[12].uri=lb://suppliers-service/actuator/suppliers/**
spring.cloud.gateway.server.webflux.routes[12].predicates[0]=Path=/actuator/suppliers/**

# CLIENTS SERVICE ACTUATOR ROUTE
spring.cloud.gateway.server.webflux.routes[13].id=clients-service-actuator
spring.cloud.gateway.server.webflux.routes[13].uri=lb://clients-service/actuator/clients/**
spring.cloud.gateway.server.webflux.routes[13].predicates[0]=Path=/actuator/clients/**

# JWT CONFIGURATION
jwt.algorithm=RS256
jwt.secret=${JWT_SECRET}

# AUTH SERVICE CONFIGURATION
auth-service.url=http://auth-service

# LOGGING CONFIGURATION
logging.level.root=info
logging.level.com.ClinicaDeYmid.api_gateway=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.gateway.route.RouteDefinitionRouteLocator=info
logging.level.org.springframework.web.reactive.function.client=DEBUG
logging.level.com.netflix.discovery=DEBUG

# SWAGGER DOCUMENTATION ROUTES (SIN FILTRO DE AUTENTICACION)
# AUTH SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[14].id=auth-service-swagger
spring.cloud.gateway.server.webflux.routes[14].uri=lb://auth-service
spring.cloud.gateway.server.webflux.routes[14].predicates[0]=Path=/v3/api-docs/auth-service
spring.cloud.gateway.server.webflux.routes[14].filters[0]=RewritePath=/v3/api-docs/auth-service, /v3/api-docs

# PATIENT SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[15].id=patient-service-swagger
spring.cloud.gateway.server.webflux.routes[15].uri=lb://patient-service
spring.cloud.gateway.server.webflux.routes[15].predicates[0]=Path=/v3/api-docs/patient-service
spring.cloud.gateway.server.webflux.routes[15].filters[0]=RewritePath=/v3/api-docs/patient-service, /v3/api-docs

# BILLING SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[16].id=billing-service-swagger
spring.cloud.gateway.server.webflux.routes[16].uri=lb://billing-service
spring.cloud.gateway.server.webflux.routes[16].predicates[0]=Path=/v3/api-docs/billing-service
spring.cloud.gateway.server.webflux.routes[16].filters[0]=RewritePath=/v3/api-docs/billing-service, /v3/api-docs

# ADMISSIONS SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[17].id=admissions-service-swagger
spring.cloud.gateway.server.webflux.routes[17].uri=lb://admissions-service
spring.cloud.gateway.server.webflux.routes[17].predicates[0]=Path=/v3/api-docs/admissions-service
spring.cloud.gateway.server.webflux.routes[17].filters[0]=RewritePath=/v3/api-docs/admissions-service, /v3/api-docs

# AI ASSISTANT SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[18].id=ai-assistant-service-swagger
spring.cloud.gateway.server.webflux.routes[18].uri=lb://ai-assistant-service
spring.cloud.gateway.server.webflux.routes[18].predicates[0]=Path=/v3/api-docs/ai-assistant-service
spring.cloud.gateway.server.webflux.routes[18].filters[0]=RewritePath=/v3/api-docs/ai-assistant-service, /v3/api-docs

# SUPPLIERS SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[19].id=suppliers-service-swagger
spring.cloud.gateway.server.webflux.routes[19].uri=lb://suppliers-service
spring.cloud.gateway.server.webflux.routes[19].predicates[0]=Path=/v3/api-docs/suppliers-service
spring.cloud.gateway.server.webflux.routes[19].filters[0]=RewritePath=/v3/api-docs/suppliers-service, /v3/api-docs

# CLIENTS SERVICE SWAGGER
spring.cloud.gateway.server.webflux.routes[20].id=clients-service-swagger
spring.cloud.gateway.server.webflux.routes[20].uri=lb://clients-service
spring.cloud.gateway.server.webflux.routes[20].predicates[0]=Path=/v3/api-docs/clients-service
spring.cloud.gateway.server.webflux.routes[20].filters[0]=RewritePath=/v3/api-docs/clients-service, /v3/api-docs

#Actuator
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,loggers
management.endpoints.web.base-path=/actuator

#Resilience4j
resilience4j.circuitbreaker.instances.api-gateway.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.api-gateway.slidingWindowSize=10
resilience4j.circuitbreaker.instances.api-gateway.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.api-gateway.failureRateThreshold=50
resilience4j.circuitbreaker.instances.api-gateway.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.api-gateway.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.api-gateway.permittedNumberOfCallsInHalfOpenState=2

#Configuracion de Eureka (Docker)
eureka.client.service-url.defaultZone=http://eureka-service:8761/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.initial-status-if-eureka-not-available=UP