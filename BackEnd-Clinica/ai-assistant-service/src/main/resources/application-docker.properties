spring.application.name=ai-assistant-service

# ========== CONFIGURACION DE BASE DE DATOS (PostgreSQL) ==========
spring.datasource.url=jdbc:postgresql://localhost:3310/${AI_ASSISTANT_DB_NAME}
spring.datasource.username=${AI_ASSISTANT_DB_USER}
spring.datasource.password=${AI_ASSISTANT_DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# ========== CONFIGURACION DE POOL DE CONEXIONES HIKARICP (DOCKER) ==========
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.pool-name="AIAssistantHikariCP"
spring.datasource.hikari.leak-detection-threshold=10000

# ========== CONFIGURACION JPA (DOCKER) ==========
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.format_sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ========== CONFIGURACION DE FLYWAY ==========
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration/ai

# ========== CONFIGURACION DE GEMINI API ==========
spring.ai.google.genai.api-key=${GEMINI_API_KEY}
spring.ai.google.genai.chat.options.model=gemini-2.0-flash
spring.ai.google.genai.chat.options.temperature=0.7
spring.ai.google.genai.chat.options.max-output-tokens=2048

# ========== CONFIGURACION JWT ==========
jwt.algorithm=RS256
jwt.secret=${JWT_SECRET}
jwt.rsa.public-key=${JWT_PUBLIC_KEY:}
jwt.rsa.public-key-path=

# ========== CONFIGURACION DE FEIGN ==========
feign.client.config.default.connectTimeout=3000
feign.client.config.default.readTimeout=5000
feign.client.config.default.loggerLevel=BASIC
feign.client.config.admissions-service.connectTimeout=3000
feign.client.config.admissions-service.readTimeout=5000
feign.hystrix.enabled=false
feign.httpclient.enabled=true

# ========== CONFIGURACION DE EUREKA (DOCKER) ==========
eureka.client.service-url.defaultZone=http://eureka-service:8761/eureka/
eureka.client.fetch-registry=true
eureka.client.register-with-eureka=true
eureka.instance.prefer-ip-address=true
eureka.instance.initial-status=UP

# ========== CONFIGURACION DE SERVIDOR (DOCKER) ==========
server.error.include-message=never
server.error.include-stacktrace=never
spring.web.resources.add-mappings=false

# ========== CONFIGURACION DE LOGGING (DOCKER) ==========
logging.level.root=WARN
logging.level.org.springframework=INFO
logging.level.org.hibernate=WARN
logging.level.com.zaxxer.hikari=WARN
logging.level.org.flywaydb=INFO
logging.level.com.ClinicaDeYmid.ai_assistant_service=INFO
logging.level.org.springframework.ai=INFO
logging.file.name=/var/log/ai-assistant-service/ai-assistant-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=7

# ========== ACTUATOR (DOCKER) ==========
management.endpoints.web.exposure.include=health,info,metrics
management.endpoints.web.base-path=/actuator
management.endpoint.health.show-details=never

# ========== RESILIENCE4J (DOCKER) ==========
resilience4j.circuitbreaker.instances.ai-assistant-service.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.ai-assistant-service.slidingWindowSize=10
resilience4j.circuitbreaker.instances.ai-assistant-service.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.ai-assistant-service.failureRateThreshold=50
resilience4j.circuitbreaker.instances.ai-assistant-service.waitDurationInOpenState=30s
resilience4j.circuitbreaker.instances.ai-assistant-service.automaticTransitionFromOpenToHalfOpenEnabled=true
resilience4j.circuitbreaker.instances.ai-assistant-service.permittedNumberOfCallsInHalfOpenState=2
